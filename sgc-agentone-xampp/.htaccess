RewriteEngine On

# Configuration SGC-AgentOne XAMPP
# Routage API et assets pour Apache

# Headers de sécurité et CORS
Header always set Access-Control-Allow-Origin "*"
Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-API-Key"
Header always set Cache-Control "no-cache"

# Gestion des requêtes OPTIONS (preflight CORS)
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ index.php [QSA,L]

# Routes API - Redirection vers les handlers appropriés
RewriteRule ^api/auth/token/?$ core/api/auth.php [QSA,L]
RewriteRule ^api/prompts/?(.*)$ core/api/prompts.php [QSA,L]
RewriteRule ^api/chat/?$ core/api/chat.php [QSA,L]
RewriteRule ^api/server/?(.*)$ core/api/server.php [QSA,L]

# Assets statiques (CSS, JS, fonts)
RewriteRule ^extensions/(.+)$ extensions/$1 [L]
RewriteRule ^core/(.+\.(css|js|woff|woff2|ttf|png|jpg|svg))$ core/$1 [L]

# Interface principale - redirection vers index.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php [QSA,L]

# Configuration Apache pour performance
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/css text/javascript application/javascript application/json
</IfModule>

<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType font/woff2 "access plus 1 year"
</IfModule>

# Sécurité - Bloquer accès aux fichiers sensibles
<Files "*.json">
    Require all denied
</Files>

<FilesMatch "\.(log|db)$">
    Require all denied
</FilesMatch>